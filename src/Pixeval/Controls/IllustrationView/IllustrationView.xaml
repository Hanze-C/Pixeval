<UserControl
    x:Class="Pixeval.Controls.IllustrationView.IllustrationView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:Pixeval.Util.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Pixeval.Controls.IllustrationView"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:options="using:Pixeval.Options"
    xmlns:winUi="using:CommunityToolkit.WinUI"
    Unloaded="IllustrationViewOnUnloaded"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:BoolToItemsViewSelectionModeConverter x:Key="BoolToItemsViewSelectionModeConverter" />
    </UserControl.Resources>
    <Grid>
        <ScrollViewer
            x:Name="ScrollViewer"
            x:FieldModifier="public"
            ViewChanged="ScrollViewerViewChanged">
            <StackPanel>
                <!--  ReSharper disable once UnusedMember.Local  -->
                <ItemsView
                    x:Name="IllustrationItemsView"
                    IsItemInvokedEnabled="True"
                    ItemInvoked="IllustrationItemsView_OnItemInvoked"
                    ItemsSource="{x:Bind ViewModel.DataProvider.ItemsViewSource, Mode=OneWay}"
                    SelectionMode="{x:Bind ViewModel.IsSelecting, Converter={StaticResource BoolToItemsViewSelectionModeConverter}, Mode=OneWay}">
                    <ItemsView.ItemTemplate>
                        <DataTemplate x:DataType="local:IllustrationViewModel">
                            <ItemContainer IsSelected="{x:Bind IsSelected, Mode=TwoWay}">
                                <local:IllustrationThumbnail
                                    EffectiveViewportChanged="IllustrationThumbnailContainerItemOnEffectiveViewportChanged"
                                    IsTapEnabled="False"
                                    ShowQrCodeRequested="IllustrationThumbnailOnShowQrCodeRequested"
                                    ThisRequired="IllustrationThumbnail_OnThisRequired"
                                    ViewModel="{x:Bind}" />
                            </ItemContainer>
                        </DataTemplate>
                    </ItemsView.ItemTemplate>
                </ItemsView>
                <StackPanel
                    x:Name="LoadingArea"
                    Height="100"
                    HorizontalAlignment="Center"
                    Orientation="Horizontal"
                    Spacing="50">
                    <ProgressRing
                        Width="40"
                        Height="40"
                        VerticalAlignment="Center"
                        IsIndeterminate="True" />
                    <TextBlock VerticalAlignment="Center">Loading</TextBlock>
                    <!--  TODO move to ResW  -->
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
        <StackPanel
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Spacing="20"
            Visibility="{x:Bind ViewModel.HasNoItems, Mode=OneWay}">
            <Image
                Width="200"
                Height="200"
                Source="/Assets/Images/empty-box.png" />
            <TextBlock
                x:Uid="/IllustrationView/ResultIsEmptyTextBlock"
                HorizontalAlignment="Center"
                FontSize="{StaticResource PixevalTitleFontSize}" />
        </StackPanel>
        <TeachingTip
            x:Name="QrCodeTeachingTip"
            x:Uid="/IllustrationView/QrCodeTeachingTip"
            IsLightDismissEnabled="True">
            <TeachingTip.HeroContent>
                <Image />
            </TeachingTip.HeroContent>
        </TeachingTip>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="Group">
                <VisualState x:Name="VisualStateGrid">
                    <VisualState.StateTriggers>
                        <winUi:IsEqualStateTrigger Value="{x:Bind IllustrationViewOption}" To="{x:Bind options:IllustrationViewOption.LinedFlow}" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="IllustrationItemsView.Layout">
                            <Setter.Value>
                                <LinedFlowLayout
                                    ItemsStretch="Fill"
                                    LineHeight="{x:Bind DesiredHeight, Mode=OneWay}"
                                    LineSpacing="5"
                                    MinItemSpacing="5" />
                            </Setter.Value>
                        </Setter>
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="VisualStateLinedFlow">
                    <VisualState.StateTriggers>
                        <winUi:IsEqualStateTrigger Value="{x:Bind IllustrationViewOption}" To="{x:Bind options:IllustrationViewOption.Grid}" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="IllustrationItemsView.Layout">
                            <Setter.Value>
                                <UniformGridLayout
                                    ItemsStretch="Fill"
                                    MinColumnSpacing="5"
                                    MinItemHeight="{x:Bind DesiredHeight, Mode=OneWay}"
                                    MinItemWidth="180"
                                    MinRowSpacing="5" />
                            </Setter.Value>
                        </Setter>
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="VisualStateVerticalStack">
                    <VisualState.StateTriggers>
                        <winUi:IsEqualStateTrigger Value="{x:Bind IllustrationViewOption}" To="{x:Bind options:IllustrationViewOption.VerticalStack}" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="IllustrationItemsView.Layout">
                            <Setter.Value>
                                <StackLayout Orientation="Vertical" Spacing="5" />
                            </Setter.Value>
                        </Setter>
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="VisualStateHorizontalStack">
                    <VisualState.StateTriggers>
                        <winUi:IsEqualStateTrigger Value="{x:Bind IllustrationViewOption}" To="{x:Bind options:IllustrationViewOption.HorizontalStack}" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="IllustrationItemsView.Layout">
                            <Setter.Value>
                                <StackLayout Orientation="Horizontal" Spacing="5" />
                            </Setter.Value>
                        </Setter>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</UserControl>
